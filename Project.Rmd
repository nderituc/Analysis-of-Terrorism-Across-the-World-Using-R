---
title: "Project"
author: "Sharon and Catherine"
date: '2022-04-14'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown



## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

This project seeks to understand how terrorism has impacted the world.
The following questions will be used to understand the dataset;
1. Has global terrorism reduced or increased over the years?(line chart)
2. How do terrorism fatalities compare across countries in the world? (Choropleth map)
3. Which region has highly been affected by terrorism?
4. What’s the happiness index and GDP of the country highly affected by terrorism? Compare

## Load Packages and Import Data
The chunk below contains the packages that will be needed for this project.

```{r Load Packages, message=FALSE}
#Load necessary packages
library(tidyverse) #For performing data transformation
library(ggplot2) #For creating charts
library(readr) #For importing data
library(dplyr) #For performing data transformation
```

```{r Import Data, message = FALSE}
#Import dataset containing terrorism fatalities
terrorism_fatalities <- readr::read_csv("fatalities-from-terrorism.csv", show_col_types = FALSE)
```

```{r Display Dataset}
#Display the first five rows of the imported dataset
as_tibble(terrorism_fatalities)
head(terrorism_fatalities)
```

##Data Transformation

Check for the number of rows and columns
```{r Rows}
#Number of rows
nrow(terrorism_fatalities)
```

```{r Columns}
#Number of columns
ncol(terrorism_fatalities)
```


```{r Missing Values}
#Check for missing values
#sum(is.na(terrorism_fatalities))

colSums(is.na(terrorism_fatalities))
```

The terrorism fatalities dataset has no missing values.

Check for unique values in the 'Entity' column.
```{r}
#Unique values in the dataset
unique(terrorism_fatalities[c("Entity")])
```

Rename 'Entity' column to 'Country'.
```{r Rename}
terrorism_fatalities <- terrorism_fatalities %>%
  rename(Country = Entity)
```

Summary statistics
```{r Summary}
summary_stat <- terrorism_fatalities %>% 
  group_by(Country) %>%
  summarise(
    count = n(),
    avg = mean(Fatalities),
    minimum = min(Fatalities),
    maximum = max(Fatalities)
  ) %>% 
  arrange()
summary_stat

```


Since our dataset is tidy, we will go ahead and analyse our data based on our research questions.
###1. Which region has highly been affected by terrorism?

Reorder the dataset to check which country has had the highest number of fatalities as a result of terrorism

```{r Arrange}
highest <- terrorism_fatalities %>% 
  group_by(Country) %>%
  summarise(maximum = max(Fatalities)) %>% 
  arrange(desc(maximum)) #Ordering the values from the highest to the lowest

highest
```

From the tibble above, we can see that Iraq has had the highest number of fatalities resulting from terrorism, followed by Nigeria then Afghanistan.

###2. Has global terrorism reduced or increased over the years (Between 2000-2017) in the top 5 countries with the highest fatalities? From the above tibble, we can see that the top nine countries are Iraq, Nigeria, Afghanistan, Algeria, Syria, Nicaragua, USA, Pakistan, Peru and El Salvador

```{r}
highest_terrorism <- highest %>% 
  filter(maximum >= 3924)

lowest_terrorism <- highest %>% 
  filter(maximum == 0)

highest_terrorism
```

```{r Merge dataset}
highest_terrorism <- highest_terrorism %>%
  left_join(terrorism_fatalities, by = "Country")

highest_terrorism
```


```{r plot}
highest_terrorism <- highest_terrorism %>% 
  filter(Year >= 2000)
ggplot(highest_terrorism, aes(x = Year, y = Fatalities, group=Country, color=Country)) + 
  geom_line()

```

###3. What’s the life satisfaction and GDP of the regions highly/lowly affected by terrorism? Compare

```{r Import Data, message = FALSE}
#Import dataset containing life satisfaction and gdp of countries
gdp_happiness <- readr::read_csv("gdp-vs-life-satisfaction.csv", show_col_types = FALSE)
```

```{r}
gdp_happiness 
```

```{r Merge dataset}
joined_data <- highest_terrorism %>%
  left_join(gdp_happiness, by = "Country")
joined_data
```

```{r}
comparison_data <- joined_data %>%
  group_by(Country) %>% 
  summarise(
    avg_satisfaction = mean(Life_Satisfaction, na.rm = TRUE),
    avg_fatalities = mean(Fatalities, na.rm = TRUE),
    avg_gdp = mean(GDP, na.rm = TRUE))
comparison_data
```

```{r}
#import library gridExtra
library(gridExtra)

fatalities_plot <- comparison_data %>% 
  ggplot(mapping = aes(x = Country, y = avg_fatalities))+
  geom_bar(stat="identity", width=1, color="white",
         fill=rgb(0.1,0.4,0.5,0.7))

satisfaction_plot <- comparison_data %>% 
  ggplot(mapping = aes(x = Country, y = avg_satisfaction))+
  geom_bar(stat="identity", width=1, color="white",
         fill=rgb(0.1,0.8,0.1,0.7))
 
gdp_plot <- comparison_data %>% 
  ggplot(mapping = aes(x = Country, y = avg_gdp))+
  geom_bar(stat="identity", width=1, color="white",
         fill=rgb(0.8,0.4,0.1,0.7)) 
 
# Use grid.arrange to put plots in columns
grid.arrange(fatalities_plot,satisfaction_plot,gdp_plot, ncol=3)
```


###4. How do terrorism fatalities compare across countries in the world? (Choropleth map)

```{r}
terrorism_fatalities
```


Compute the average terrorism rate for each country
```{r}
#Group by Country and find the terrorism rate for each country
terrorism_fatalities <- terrorism_fatalities %>% 
  group_by(Country) %>% 
  summarise(Fatalities=mean(Fatalities))
```

Rename 'Country' column to 'region'.
```{r Rename}
terrorism_fatalities <- terrorism_fatalities %>%
  rename(region = Country)
```

Plot the choropleth map
```{r Choropleth Map}
#Convert from tibble to dataframe
terrorism_fatalities <- as.data.frame(terrorism_fatalities)

#Data containing longitudes and latitudes to be used in mapping the data
global_map <- map_data("world")

#Merge the "world" map_data to the terrorism_fatalities dataset
merged_data <- left_join(global_map, terrorism_fatalities, by = "region")

#Plot the map
ggplot(merged_data, aes(long, lat, label = region ,group = group))+
  geom_polygon(aes(fill = Fatalities), color = "white")+
  ggtitle("Fatalities Resulting From Terrorism Activities Across the World")+
  scale_fill_viridis_c(option = "C")+
  theme(#panel.background = element_rect(fill = "white"),
        #plot.background = element_rect(fill = "white"),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks = element_blank(),
        #rect = element_blank(),
        #panel.border =  element_blank(),
        legend.title= element_text(
          hjust = 0.4 ,vjust=0.3, size=10,family = "Times"),
        legend.text = element_text(
          hjust = 0.4 ,vjust=2, size=8,family = "Times"))
  

```





